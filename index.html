<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>‡¶¨‡¶æ‡¶á‡¶§‡ßÅ‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶¶ ‡¶ú‡¶æ‡¶Æ‡ßá ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ | ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</title>
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Firebase SDK (modular) -->
  <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
  </script>
  <style>
    /* ----- ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§) ----- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Noto Sans Bengali', sans-serif; font-size: 18px; line-height: 1.6; min-height: 100vh; background-color: #0a0f1a; }
    .login-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('https://images.unsplash.com/photo-1591604129939-f1efa4d9f7fa?q=80&w=2070&auto=format&fit=crop') center/cover no-repeat; filter: brightness(0.4) saturate(1.3); z-index: -2; }
    .app-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('https://images.unsplash.com/photo-1584551246679-0daf3d275d0f?q=80&w=2070&auto=format&fit=crop') center/cover no-repeat; filter: brightness(0.25) saturate(1.2); z-index: -2; }
    .overlay { background: rgba(0,10,18,0.85); backdrop-filter: blur(6px); min-height: 100vh; padding: 25px 20px; color: white; display: flex; flex-direction: column; }
    .container { max-width: 1300px; margin: 0 auto; width: 100%; flex: 1; display: flex; flex-direction: column; }
    .login-wrapper { display: flex; justify-content: center; align-items: center; flex: 1; width: 100%; }
    #loginBox { max-width: 480px; width: 100%; background: rgba(255,255,255,0.96); backdrop-filter: blur(12px); border-radius: 40px; padding: 45px 40px; box-shadow: 0 40px 70px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,215,0,0.3); border: 1px solid rgba(255,215,0,0.4); text-align: center; color: #000; }
    .mosque-icon { font-size: 5rem; color: #c49b3f; margin-bottom: 15px; }
    #loginBox h2 { color: #0b4f2b; font-weight: 700; font-size: 2.4rem; margin-bottom: 15px; }
    .subtitle { color: #2d3e50; margin-bottom: 30px; border-bottom: 1px dashed #c49b3f; padding-bottom: 15px; font-weight: 500; font-size: 1.2rem; }
    #loginBox input { background: #f5f7fa; border: 1px solid #d4dcec; border-radius: 60px; padding: 18px 24px; margin-bottom: 20px; width: 100%; font-size: 1.1rem; color: #000; }
    #loginBox input::placeholder { color: #666; font-size: 1rem; }
    #loginBox button { background: linear-gradient(145deg, #0b6b35, #064d26); border: none; border-radius: 60px; padding: 18px; font-weight: 700; font-size: 1.3rem; color: white; width: 100%; cursor: pointer; transition: 0.2s; }
    .login-footer { margin-top: 25px; color: #2d3e50; font-size: 1rem; }
    /* ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® */
    .splash-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: url('https://images.unsplash.com/photo-1542816417-0983c9c9ad53?q=80&w=2070&auto=format&fit=crop') center/cover no-repeat; filter: brightness(0.7); display: flex; justify-content: center; align-items: center; z-index:2000; opacity:0; transition: opacity 1.5s ease; pointer-events: none; }
    .splash-screen.show { opacity:1; pointer-events: all; }
    .splash-content { text-align: center; color: white; text-shadow: 0 4px 20px rgba(0,0,0,0.8); background: rgba(0,0,0,0.4); padding: 50px 70px; border-radius: 80px; backdrop-filter: blur(10px); border: 3px solid rgba(255,215,0,0.7); box-shadow: 0 20px 40px rgba(0,0,0,0.5); animation: glow 2s infinite alternate; }
    .splash-content h1 { font-size: 4.5rem; margin-bottom: 20px; color: #f5e7c8; letter-spacing: 2px; }
    .splash-content i { font-size: 6rem; color: #c49b3f; margin-bottom: 20px; }
    @keyframes glow { from { box-shadow: 0 20px 40px rgba(0,0,0,0.5); } to { box-shadow: 0 30px 60px rgba(196,155,63,0.5); } }
    #app { display: none; }
    h1 { text-align: center; font-weight: 700; font-size: 2.5rem; margin-bottom: 20px; color: #f5e7c8; text-shadow: 0 2px 10px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; gap: 15px; }
    h1 i { font-size: 3rem; }
    .card { background: rgba(10,20,30,0.9); backdrop-filter: blur(4px); color: #f0f3fa; padding: 28px; border-radius: 32px; margin: 25px 0; box-shadow: 0 25px 40px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,215,0,0.15); border: 1px solid rgba(255,215,0,0.1); transition: transform 0.2s; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 30px 50px rgba(0,0,0,0.8); }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
    .stat-card { background: linear-gradient(145deg, #0f2a1a, #071a0e); color: #e6f0e6; padding: 25px 15px; border-radius: 28px; text-align: center; border: 1px solid #c49b3f60; box-shadow: 0 10px 20px rgba(0,0,0,0.5); transition: all 0.2s; }
    .stat-card:hover { border-color: #c49b3f; box-shadow: 0 15px 30px rgba(196,155,63,0.2); }
    .stat-card h3 { font-size: 1.3rem; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .stat-card p { font-size: 2.2rem; font-weight: 700; }
    .three-dot { background: rgba(255,255,255,0.15); border-radius: 50%; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.4rem; transition: 0.2s; margin-left: 8px; }
    .three-dot:hover { background: rgba(196,155,63,0.3); transform: scale(1.1); }
    .details { display: none; background: #10222e; padding: 18px; border-radius: 20px; margin-top: 15px; color: #cbd5e0; font-size: 1rem; max-height: 250px; overflow-y: auto; border: 1px solid #c49b3f30; }
    input, select, button { width: 100%; padding: 16px 22px; margin: 12px 0; border-radius: 50px; border: 1px solid #2d3f55; background: #1e2a36; color: white; font-size: 1.1rem; transition: 0.2s; }
    input::placeholder { color: #a0b0c0; }
    input:focus, select:focus { border-color: #c49b3f; box-shadow: 0 0 0 3px rgba(196,155,63,0.3); outline: none; }
    button { background: linear-gradient(145deg, #0b6b35, #0a4f2a); color: white; font-weight: 600; border: none; box-shadow: 0 8px 18px rgba(0,0,0,0.5); cursor: pointer; font-size: 1.2rem; transition: all 0.2s; }
    button:hover { background: linear-gradient(145deg, #0d7e3f, #0b6b35); transform: scale(1.02); box-shadow: 0 12px 24px rgba(0,0,0,0.6); }
    button i { margin-right: 10px; }
    .logout { background: linear-gradient(145deg, #8b0000, #5a0000); }
    .logout:hover { background: linear-gradient(145deg, #a00000, #6b0000); }
    .cancel-btn { background: #4a5568; }
    .section-title { font-weight: 700; font-size: 1.8rem; color: #e4c580; display: flex; align-items: center; gap: 12px; border-bottom: 3px solid #e4c580; padding-bottom: 10px; margin-bottom: 25px; }
    .section-title i { font-size: 2rem; }
    .section-title .three-dot { margin-left: auto; }
    .search-wrapper { position: relative; display: flex; gap: 15px; background: #1e2f3a; border-radius: 60px; padding: 6px; margin-bottom: 30px; }
    .search-wrapper input { margin: 0; border: none; background: transparent; padding: 14px 25px; color: white; font-size: 1.1rem; flex: 1; }
    .search-wrapper button { width: auto; padding: 14px 35px; margin: 0; }
    .autocomplete-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: #1e2f3a; border: 1px solid #3f5568; border-radius: 20px; margin-top: 5px; max-height: 200px; overflow-y: auto; z-index: 100; display: none; }
    .autocomplete-item { padding: 12px 20px; cursor: pointer; color: #e2e8f0; transition: 0.2s; }
    .autocomplete-item:hover { background: #2d3f55; color: #e4c580; }
    .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    .member-card { background: #1c2a36; border-radius: 28px; padding: 22px; border: 1px solid #3f5568; color: #e2e8f0; transition: 0.2s; box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
    .member-card:hover { transform: translateY(-4px); border-color: #c49b3f; box-shadow: 0 15px 30px rgba(196,155,63,0.15); }
    .member-card h4 { color: #e4c580; font-size: 1.4rem; border-bottom: 1px dashed #5f6f80; padding-bottom: 12px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
    .member-card p { font-size: 1.1rem; margin: 8px 0; }
    .card-actions { display: flex; gap: 8px; }
    .action-btn { background: transparent; border: none; color: #c49b3f; font-size: 1.3rem; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; transition: 0.2s; }
    .action-btn:hover { background: rgba(196,155,63,0.2); transform: scale(1.1); }
    .delete-btn { color: #f87171; }
    .delete-btn:hover { background: rgba(248,113,113,0.2); }
    .due-highlight { color: #ff9999; font-weight: 600; }
    .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap: 15px; margin-top: 20px; }
    .category-item { background: #1c2a36; border-radius: 20px; padding: 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #3f5568; }
    .category-name { font-size: 1.1rem; font-weight: 500; }
    .project-list { display: flex; flex-direction: column; gap: 12px; margin: 20px 0; }
    .project-item { background: rgba(30,47,58,0.8); border-radius: 60px; border: 1px solid #3f5568; overflow: hidden; transition: all 0.3s; }
    .project-item:hover { border-color: #c49b3f; box-shadow: 0 8px 20px rgba(196,155,63,0.2); }
    .project-name-btn { width: 100%; text-align: left; padding: 18px 28px; background: transparent; border: none; color: #e4c580; font-size: 1.3rem; font-weight: 600; display: flex; align-items: center; gap: 15px; cursor: pointer; transition: 0.2s; }
    .project-name-btn i { font-size: 1.5rem; color: #c49b3f; transition: transform 0.3s; }
    .project-name-btn:hover i { transform: translateX(5px); }
    .project-details { display: none; background: #0f1a24; padding: 20px; border-top: 1px solid #2f4050; }
    .project-details.show { display: block; }
    .detail-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed #2f4050; }
    .detail-label { color: #a0b0c0; }
    .detail-value { color: #f0f3fa; font-weight: 600; }
    .detail-actions { display: flex; justify-content: space-between; gap: 10px; margin-top: 20px; }
    .detail-actions button { width: 48%; padding: 12px; font-size: 1rem; }
    .data-table, .work-table { width: 100%; border-collapse: collapse; background: #1e2f3a; border-radius: 24px; overflow: hidden; font-size: 1.1rem; margin-top: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
    .data-table th, .work-table th { background: linear-gradient(145deg, #0b4f2b, #0a3f22); color: #f5e7c8; font-weight: 700; padding: 16px 12px; text-align: center; border-bottom: 2px solid #c49b3f; font-size: 1.2rem; }
    .data-table td, .work-table td { padding: 14px 12px; border-bottom: 1px solid #2f4050; color: #e0e7ff; }
    .data-table tbody tr:hover, .work-table tbody tr:hover { background-color: #2d3f55; }
    .data-table .action-btn { font-size: 1.2rem; }
    .detail-modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; z-index:3000; }
    .detail-modal.hidden { display: none; }
    .detail-modal-content { background: #1e2a36; border-radius: 40px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 2px solid #c49b3f; box-shadow: 0 30px 60px rgba(0,0,0,0.7); }
    .detail-modal-content h3 { color: #e4c580; font-size: 2rem; margin-bottom: 20px; border-bottom: 2px solid #c49b3f; padding-bottom: 10px; }
    .detail-list { margin-bottom: 20px; }
    .detail-item { display: flex; justify-content: space-between; align-items: center; background: #0f1a24; padding: 10px 15px; border-radius: 40px; margin-bottom: 8px; }
    .detail-item span { font-size: 1.1rem; }
    .detail-item .actions { display: flex; gap: 5px; }
    .detail-add-form { display: flex; gap: 10px; margin-top: 15px; }
    .detail-add-form input { flex: 1; margin: 0; }
    .detail-add-form button { width: auto; padding: 14px 25px; margin: 0; }
    .close-modal { background: #8b0000; margin-top: 20px; }
    .credit-card { text-align: center; margin-top: 30px; padding: 15px 10px; border-top: 1px solid #c49b3f30; font-size: 1.1rem; }
    .credit-card .credit-trigger { display: inline-block; background: rgba(196,155,63,0.1); padding: 8px 20px; border-radius: 40px; color: #e4c580; cursor: pointer; transition: 0.2s; border: 1px solid #c49b3f30; }
    .credit-card .credit-trigger:hover { background: #c49b3f30; transform: scale(1.05); }
    .credit-modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; z-index:4000; }
    .credit-modal.hidden { display: none; }
    .credit-modal-content { background: linear-gradient(145deg, #0f2a1a, #071a0e); border-radius: 50px; padding: 40px; max-width: 500px; width: 90%; border: 3px solid #c49b3f; box-shadow: 0 30px 60px rgba(196,155,63,0.3); text-align: center; }
    .credit-modal-content h2 { color: #e4c580; font-size: 2.2rem; margin-bottom: 20px; border-bottom: 2px solid #c49b3f; padding-bottom: 10px; }
    .credit-info { font-size: 1.3rem; line-height: 2; color: #f0f3fa; }
    .credit-info a { color: #c49b3f; text-decoration: none; border-bottom: 1px dotted; }
    .credit-info a:hover { color: #e4c580; }
    .credit-info i { margin-right: 8px; }
    .close-credit { background: #8b0000; margin-top: 30px; }
    .hidden { display: none !important; }
    .admin-only { display: block; }
    .spinner { border: 5px solid rgba(255,215,0,0.1); border-left-color: #c49b3f; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 30px auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .slider { padding: 0; border-radius: 40px; overflow: hidden; }
    .slide-img { width: 100%; display: none; aspect-ratio: 16/9; object-fit: cover; }
    .active-slide { display: block; }
    .footer-note { text-align: center; color: #e4c580; margin-top: 40px; font-size: 1.1rem; }
    @media (max-width: 600px) { body { font-size: 16px; } h1 { font-size: 2rem; } .grid { grid-template-columns: 1fr; } .search-wrapper { flex-wrap: wrap; } .search-wrapper button { width: 100%; } #loginBox { padding: 30px 20px; } .action-btn { width: 36px; height: 36px; } .project-name-btn { font-size: 1.1rem; } .splash-content h1 { font-size: 2.5rem; } }
  </style>
</head>
<body>
<div id="bgLogin" class="login-bg"></div>
<div id="bgApp" class="app-bg" style="display: none;"></div>

<!-- ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® -->
<div id="splashScreen" class="splash-screen">
  <div class="splash-content">
    <i class="fas fa-mosque"></i>
    <h1>‡¶¨‡¶æ‡¶á‡¶§‡ßÅ‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶¶ ‡¶ú‡¶æ‡¶Æ‡ßá ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ</h1>
  </div>
</div>

<div class="overlay">
  <div class="container">
    <h1><i class="fas fa-mosque"></i> ‡¶¨‡¶æ‡¶á‡¶§‡ßÅ‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶¶ ‡¶ú‡¶æ‡¶Æ‡ßá ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ <i class="fas fa-star"></i></h1>

    <!-- ‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡¶ï‡ßç‡¶∏ (‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶´‡¶æ‡¶Å‡¶ï‡¶æ) -->
    <div id="loginBox" class="login-wrapper">
      <div style="width: 100%;">
        <div class="mosque-icon"><i class="fas fa-kaaba"></i></div>
        <h2><i class="fas fa-lock"></i> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h2>
        <div class="subtitle">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®</div>
        <input type="email" id="email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" autocomplete="off" value="">
        <input type="password" id="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" autocomplete="off" value="">
        <button onclick="login()"><i class="fas fa-sign-in-alt"></i> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂</button>
        <div class="login-footer">
          <i class="fas fa-shield-alt"></i> ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶á‡¶Æ‡¶æ‡¶Æ ‡¶ì ‡¶∏‡¶ö‡¶ø‡¶¨
        </div>
      </div>
    </div>

    <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ (‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡¶´‡¶≤ ‡¶≤‡¶ó‡¶á‡¶®‡ßá‡¶∞ ‡¶™‡¶∞) -->
    <div id="app">
      <div id="loadingSpinner" class="spinner" style="display: none;"></div>

      <div class="grid">
        <div class="stat-card">
          <h3><i class="fas fa-arrow-down"></i> ‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º <span class="three-dot" onclick="toggleIncomeDetails()">‚ãÆ</span></h3>
          <p id="totalIncome">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <div id="incomeDetails" class="details"></div>
        </div>
        <div class="stat-card">
          <h3><i class="fas fa-arrow-up"></i> ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º <span class="three-dot" onclick="toggleExpenseDetails()">‚ãÆ</span></h3>
          <p id="totalExpense">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <div id="expenseDetails" class="details"></div>
        </div>
        <div class="stat-card">
          <h3><i class="fas fa-scale-balanced"></i> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</h3>
          <p id="balance">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</p>
        </div>
      </div>

      <!-- ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü -->
      <div class="card">
        <canvas id="financeChart" style="max-height: 300px; width:100%;"></canvas>
      </div>

      <div class="slider card">
        <img src="https://images.unsplash.com/photo-1591604129939-f1efa4d9f7fa?q=80&w=2070&auto=format&fit=crop" class="slide-img active-slide" alt="‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶">
        <img src="https://images.unsplash.com/photo-1564769625905-50e93615e769?q=80&w=2070&auto=format&fit=crop" class="slide-img" alt="‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶≠‡¶ø‡¶§‡¶∞">
        <img src="https://images.unsplash.com/photo-1584551246679-0daf3d275d0f?q=80&w=2070&auto=format&fit=crop" class="slide-img" alt="‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶¨‡¶æ‡¶π‡¶ø‡¶∞">
      </div>

      <!-- ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ -->
      <div class="card">
        <div class="section-title"><i class="fas fa-users"></i> ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</div>
        <div class="search-wrapper">
          <input type="text" id="memberSearchInput" placeholder="‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." onkeyup="handleSearchInput()" onblur="hideAutocomplete()">
          <button onclick="filterMembers()"><i class="fas fa-search"></i> ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</button>
          <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
        </div>
        <div id="memberListContainer" class="member-grid"></div>

        <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®-‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡¶Ç‡¶∂ -->
        <div id="adminMemberForm" class="admin-only" style="display: none;">
          <hr style="margin: 30px 0; border-color: #2f4050;">
          <div style="font-weight:700; margin-bottom:15px; font-size:1.3rem;"><i class="fas fa-user-plus"></i> ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ / ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶®</div>
          <input id="memberName" placeholder="‡¶®‡¶æ‡¶Æ">
          <input id="memberYear" type="number" placeholder="‡¶¨‡¶õ‡¶∞ (‡¶Ø‡ßá‡¶Æ‡¶® ‡ß®‡ß¶‡ß®‡ß¨)">
          <input id="memberSalary" type="number" placeholder="‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡ßá‡¶§‡¶® (‡¶ü‡¶æ‡¶ï‡¶æ)">
          <input id="payMonth" placeholder="‡¶¨‡ßá‡¶§‡¶® ‡¶Æ‡¶æ‡¶∏ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)">
          <input type="hidden" id="editingMemberId" value="">
          <button onclick="addOrUpdateMember()" id="memberSubmitBtn"><i class="fas fa-save"></i> ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ / ‡¶ú‡¶Æ‡¶æ</button>
          <button class="cancel-btn" onclick="cancelMemberEdit()" id="cancelMemberBtn" style="display: none;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>
      </div>

      <!-- ‡¶Ü‡ßü‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶§ ‡¶ì ‡¶¨‡ßç‡¶Ø‡ßü‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶§ (‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®) -->
      <div id="adminCategories" class="admin-only" style="display: none;">
        <div class="card">
          <div class="section-title">
            <i class="fas fa-tags" style="color:#a5d6a5;"></i> ‡¶Ü‡ßü‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶§
            <span class="three-dot" onclick="toggleIncomeCategoryGrid()">‚ãÆ</span>
          </div>
          <div id="incomeCategoryGrid" class="category-grid hidden"></div>
          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <input type="text" id="newIncomeCategory" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶ñ‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <button onclick="addIncomeCategory()" style="width: auto;"><i class="fas fa-plus"></i> ‡¶Ø‡ßã‡¶ó</button>
          </div>
        </div>
        <div class="card">
          <div class="section-title">
            <i class="fas fa-tags" style="color:#f9a8a8;"></i> ‡¶¨‡ßç‡¶Ø‡ßü‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶§
            <span class="three-dot" onclick="toggleExpenseCategoryGrid()">‚ãÆ</span>
          </div>
          <div id="expenseCategoryGrid" class="category-grid hidden"></div>
          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <input type="text" id="newExpenseCategory" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶ñ‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <button onclick="addExpenseCategory()" style="width: auto;"><i class="fas fa-plus"></i> ‡¶Ø‡ßã‡¶ó</button>
          </div>
        </div>
      </div>

      <!-- ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶ì ‡¶´‡¶∞‡ßç‡¶Æ -->
      <div class="card">
        <div class="section-title">
          <i class="fas fa-circle-plus" style="color:#a5d6a5;"></i> ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ
          <span class="three-dot" onclick="toggleTable('incomeTable')">‚ãÆ</span>
        </div>
        <table class="data-table hidden" id="incomeTable">
          <thead><tr><th>‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th><th>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</th></tr></thead>
          <tbody id="incomeTableBody"></tbody>
        </table>
        <div id="adminIncomeForm" class="admin-only" style="display: none;">
          <hr style="margin:20px0; border-color:#2f4050;">
          <div style="font-weight:700; margin-bottom:15px; font-size:1.3rem;"><i class="fas fa-pen"></i> ‡¶Ü‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó / ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶®</div>
          <select id="incomeCategorySelect"></select>
          <input type="number" id="incomeAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ">
          <input type="date" id="incomeDate">
          <input type="hidden" id="editingIncomeId" value="">
          <button onclick="addIncome()" id="incomeSubmitBtn"><i class="fas fa-plus"></i> ‡¶Ü‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó</button>
          <button class="cancel-btn" onclick="cancelIncomeEdit()" id="cancelIncomeBtn" style="display: none;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>
      </div>

      <!-- ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶ì ‡¶´‡¶∞‡ßç‡¶Æ -->
      <div class="card">
        <div class="section-title">
          <i class="fas fa-circle-minus" style="color:#f9a8a8;"></i> ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ
          <span class="three-dot" onclick="toggleTable('expenseTable')">‚ãÆ</span>
        </div>
        <table class="data-table hidden" id="expenseTable">
          <thead><tr><th>‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th><th>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</th></tr></thead>
          <tbody id="expenseTableBody"></tbody>
        </table>
        <div id="adminExpenseForm" class="admin-only" style="display: none;">
          <hr style="margin:20px0; border-color:#2f4050;">
          <div style="font-weight:700; margin-bottom:15px; font-size:1.3rem;"><i class="fas fa-pen"></i> ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó / ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶®</div>
          <select id="expenseCategorySelect"></select>
          <input type="number" id="expenseAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ">
          <input type="hidden" id="editingExpenseId" value="">
          <button onclick="addExpense()" id="expenseSubmitBtn"><i class="fas fa-plus"></i> ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó</button>
          <button class="cancel-btn" onclick="cancelExpenseEdit()" id="cancelExpenseBtn" style="display: none;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>
      </div>

      <!-- ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™ ‡¶ì ‡¶ï‡¶æ‡¶ú -->
      <div class="card">
        <div class="section-title">
          <i class="fas fa-hammer"></i> ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™ ‡¶ì ‡¶ï‡¶æ‡¶ú
          <span class="three-dot" onclick="toggleProjectList()">‚ãÆ</span>
        </div>
        <div id="projectListContainer" class="project-list hidden"></div>
        <div id="adminWorkForm" class="admin-only" style="display: none;">
          <hr style="margin:20px0; border-color:#2f4050;">
          <div style="font-weight:700; margin-bottom:15px; font-size:1.3rem;"><i class="fas fa-pen"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</div>
          <input id="workName" placeholder="‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
          <input id="workBudget" type="number" placeholder="‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (‡¶ü‡¶æ‡¶ï‡¶æ)">
          <select id="workStatus">
            <option value="ongoing">‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®</option>
            <option value="upcoming">‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ</option>
            <option value="completed">‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</option>
          </select>
          <input type="hidden" id="editingWorkId" value="">
          <button onclick="addWork()" id="workSubmitBtn"><i class="fas fa-plus"></i> ‡¶ï‡¶æ‡¶ú ‡¶Ø‡ßã‡¶ó</button>
          <button class="cancel-btn" onclick="cancelWorkEdit()" id="cancelWorkBtn" style="display: none;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>
      </div>

      <!-- ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶Æ‡¶°‡¶æ‡¶≤ -->
      <div id="incomeDetailModal" class="detail-modal hidden">
        <div class="detail-modal-content">
          <h3 id="incomeDetailModalTitle">‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h3>
          <div id="incomeDetailList" class="detail-list"></div>
          <div id="incomeDetailAddForm" class="detail-add-form admin-only" style="display: none;">
            <input type="text" id="incomeDetailName" placeholder="‡¶®‡¶æ‡¶Æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∞‡¶æ‡¶∂‡ßá‡¶¶)">
            <input type="number" id="incomeDetailAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ">
            <button onclick="addIncomeDetail()"><i class="fas fa-plus"></i> ‡¶Ø‡ßã‡¶ó</button>
          </div>
          <button class="close-modal" onclick="closeIncomeDetailModal()">‡¶¨‡¶®‡ßç‡¶ß</button>
        </div>
      </div>
      <div id="expenseDetailModal" class="detail-modal hidden">
        <div class="detail-modal-content">
          <h3 id="expenseDetailModalTitle">‡¶¨‡ßç‡¶Ø‡ßü‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h3>
          <div id="expenseDetailList" class="detail-list"></div>
          <div id="expenseDetailAddForm" class="detail-add-form admin-only" style="display: none;">
            <input type="text" id="expenseDetailName" placeholder="‡¶®‡¶æ‡¶Æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∞‡¶æ‡¶∂‡ßá‡¶¶)">
            <input type="number" id="expenseDetailAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ">
            <button onclick="addExpenseDetail()"><i class="fas fa-plus"></i> ‡¶Ø‡ßã‡¶ó</button>
          </div>
          <button class="close-modal" onclick="closeExpenseDetailModal()">‡¶¨‡¶®‡ßç‡¶ß</button>
        </div>
      </div>

      <!-- ‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü ‡¶Æ‡¶°‡¶æ‡¶≤ -->
      <div id="creditModal" class="credit-modal hidden">
        <div class="credit-modal-content">
          <h2><i class="fas fa-code"></i> ‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü</h2>
          <div class="credit-info">
            <p><i class="fas fa-user"></i> <strong>‡¶®‡¶æ‡¶Æ:</strong> ‡¶ñ‡¶æ‡¶≤‡ßá‡¶¶ ‡¶π‡¶æ‡¶∏‡¶æ‡¶® ‡¶∏‡¶æ‡¶®‡ßÄ</p>
            <p><i class="fas fa-briefcase"></i> <strong>‡¶ï‡¶∞‡ßç‡¶Æ‡¶∞‡¶§:</strong> <a href="https://www.facebook.com/hudhudTours" target="_blank">‡¶π‡ßÅ‡¶¶‡¶π‡ßÅ‡¶¶ ‡¶ü‡ßç‡¶Ø‡ßÅ‡¶∞‡¶∏ ‡¶è‡¶®‡ßç‡¶° ‡¶ü‡ßç‡¶∞‡¶æ‡¶≠‡ßá‡¶≤‡¶∏</a> (‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞)</p>
            <p><i class="fas fa-phone-alt"></i> <strong>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</strong> <a href="tel:+8801737884725">‡ß¶‡ßß‡ß≠‡ß©‡ß≠‡ßÆ‡ßÆ‡ß™‡ß≠‡ß®‡ß´</a> (‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™)</p>
          </div>
          <button class="close-credit" onclick="closeCreditModal()">‡¶¨‡¶®‡ßç‡¶ß</button>
        </div>
      </div>

      <button class="logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>

      <!-- ‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü ‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞ -->
      <div class="credit-card">
        <span class="credit-trigger" onclick="openCreditModal()">
          <i class="fas fa-heart" style="color: #f87171;"></i> khaled sany
        </span>
      </div>
    </div> <!-- app -->
  </div> <!-- container -->
  <div class="footer-note">üïã ‡¶¨‡¶æ‡¶á‡¶§‡ßÅ‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶¶ ‡¶ú‡¶æ‡¶Æ‡ßá ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ - ‡¶Ü‡¶≤‡ßç‡¶ü‡¶ø‡¶Æ‡ßá‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
</div> <!-- overlay -->

<script type="module">
  // ---------- ‡¶∏‡¶†‡¶ø‡¶ï Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞ (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ) ----------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut, setPersistence, inMemoryPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, setDoc, doc, getDocs, query, where, deleteDoc, getDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDkL5_qwWboVsR3x8obQ_R-IumB6wzpp8",   // ‡¶∏‡¶†‡¶ø‡¶ï apiKey
    authDomain: "baitul-hamd-jame-masjid-6ea16.firebaseapp.com",  // ‡¶∏‡¶†‡¶ø‡¶ï authDomain
    projectId: "baitul-hamd-jame-masjid-6ea16",         // ‡¶∏‡¶†‡¶ø‡¶ï projectId
    storageBucket: "baitul-hamd-jame-masjid-6ea16.firebasestorage.app",
    messagingSenderId: "885014566065",
    appId: "1:885014566065:web:ba6708013b20a05c2c7e90",
    measurementId: "G-0BQY74BH19"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  await setPersistence(auth, inMemoryPersistence);

  // DOM ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü
  const loginBox = document.getElementById('loginBox');
  const appDiv = document.getElementById('app');
  const bgLogin = document.getElementById('bgLogin');
  const bgApp = document.getElementById('bgApp');
  const spinner = document.getElementById('loadingSpinner');
  const splash = document.getElementById('splashScreen');
  let allMembers = [];
  let incomeCategories = [];
  let expenseCategories = [];
  let currentUserRole = null; // 'admin' or 'viewer'

  const searchInput = document.getElementById('memberSearchInput');
  const autocompleteDropdown = document.getElementById('autocompleteDropdown');
  const memberContainer = document.getElementById('memberListContainer');

  // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶ü‡¶ó‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  window.toggleIncomeCategoryGrid = () => {
    document.getElementById('incomeCategoryGrid').classList.toggle('hidden');
  };
  window.toggleExpenseCategoryGrid = () => {
    document.getElementById('expenseCategoryGrid').classList.toggle('hidden');
  };

  window.toggleTable = (tableId) => {
    const table = document.getElementById(tableId);
    if (table) table.classList.toggle('hidden');
  };

  window.toggleProjectList = () => {
    const container = document.getElementById('projectListContainer');
    if (container) container.classList.toggle('hidden');
  };

  // ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶®‡¶ø‡ßü‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ (‡¶Ü‡ßü)
  let currentIncomeId = null;
  window.openIncomeDetailModal = (incomeId, incomeCategory) => {
    currentIncomeId = incomeId;
    document.getElementById('incomeDetailModalTitle').innerText = `${incomeCategory} - ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§`;
    loadIncomeDetails(incomeId);
    document.getElementById('incomeDetailModal').classList.remove('hidden');
    if (currentUserRole === 'admin') {
      document.getElementById('incomeDetailAddForm').style.display = 'flex';
    } else {
      document.getElementById('incomeDetailAddForm').style.display = 'none';
    }
  };
  window.closeIncomeDetailModal = () => {
    document.getElementById('incomeDetailModal').classList.add('hidden');
    currentIncomeId = null;
  };
  async function loadIncomeDetails(incomeId) {
    const snap = await getDocs(query(collection(db, 'incomeDetails'), where('incomeId', '==', incomeId)));
    const listDiv = document.getElementById('incomeDetailList');
    let html = '';
    snap.docs.forEach(d => {
      const item = d.data();
      const deleteBtn = currentUserRole === 'admin' 
        ? `<button class="action-btn delete-btn" onclick="deleteIncomeDetail('${d.id}')"><i class="fas fa-trash"></i></button>`
        : '';
      html += `<div class="detail-item">
        <span>${item.name} : ${item.amount} ‡¶ü‡¶æ‡¶ï‡¶æ</span>
        <span class="actions">${deleteBtn}</span>
      </div>`;
    });
    listDiv.innerHTML = html || '<p>‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á</p>';
  }
  window.addIncomeDetail = async () => {
    if (currentUserRole !== 'admin' || !currentIncomeId) return;
    const name = document.getElementById('incomeDetailName').value.trim();
    const amount = Number(document.getElementById('incomeDetailAmount').value);
    if (!name || !amount) return alert('‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®');
    await addDoc(collection(db, 'incomeDetails'), {
      incomeId: currentIncomeId,
      name,
      amount,
      date: new Date()
    });
    document.getElementById('incomeDetailName').value = '';
    document.getElementById('incomeDetailAmount').value = '';
    loadIncomeDetails(currentIncomeId);
    loadIncomeDetails(); // ‡¶Æ‡ßÇ‡¶≤ ‡¶Ü‡ßü‡ßá‡¶∞ ‡¶ü‡ßã‡¶ü‡¶æ‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá
  };
  window.deleteIncomeDetail = async (detailId) => {
    if (currentUserRole !== 'admin') return;
    if (confirm('‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?')) {
      await deleteDoc(doc(db, 'incomeDetails', detailId));
      loadIncomeDetails(currentIncomeId);
    }
  };

  // ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶®‡¶ø‡ßü‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ (‡¶¨‡ßç‡¶Ø‡ßü)
  let currentExpenseId = null;
  window.openExpenseDetailModal = (expenseId, expenseCategory) => {
    currentExpenseId = expenseId;
    document.getElementById('expenseDetailModalTitle').innerText = `${expenseCategory} - ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§`;
    loadExpenseDetails(expenseId);
    document.getElementById('expenseDetailModal').classList.remove('hidden');
    if (currentUserRole === 'admin') {
      document.getElementById('expenseDetailAddForm').style.display = 'flex';
    } else {
      document.getElementById('expenseDetailAddForm').style.display = 'none';
    }
  };
  window.closeExpenseDetailModal = () => {
    document.getElementById('expenseDetailModal').classList.add('hidden');
    currentExpenseId = null;
  };
  async function loadExpenseDetails(expenseId) {
    const snap = await getDocs(query(collection(db, 'expenseDetails'), where('expenseId', '==', expenseId)));
    const listDiv = document.getElementById('expenseDetailList');
    let html = '';
    snap.docs.forEach(d => {
      const item = d.data();
      const deleteBtn = currentUserRole === 'admin' 
        ? `<button class="action-btn delete-btn" onclick="deleteExpenseDetail('${d.id}')"><i class="fas fa-trash"></i></button>`
        : '';
      html += `<div class="detail-item">
        <span>${item.name} : ${item.amount} ‡¶ü‡¶æ‡¶ï‡¶æ</span>
        <span class="actions">${deleteBtn}</span>
      </div>`;
    });
    listDiv.innerHTML = html || '<p>‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á</p>';
  }
  window.addExpenseDetail = async () => {
    if (currentUserRole !== 'admin' || !currentExpenseId) return;
    const name = document.getElementById('expenseDetailName').value.trim();
    const amount = Number(document.getElementById('expenseDetailAmount').value);
    if (!name || !amount) return alert('‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®');
    await addDoc(collection(db, 'expenseDetails'), {
      expenseId: currentExpenseId,
      name,
      amount,
      date: new Date()
    });
    document.getElementById('expenseDetailName').value = '';
    document.getElementById('expenseDetailAmount').value = '';
    loadExpenseDetails(currentExpenseId);
  };
  window.deleteExpenseDetail = async (detailId) => {
    if (currentUserRole !== 'admin') return;
    if (confirm('‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?')) {
      await deleteDoc(doc(db, 'expenseDetails', detailId));
      loadExpenseDetails(currentExpenseId);
    }
  };

  // ‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü ‡¶Æ‡¶°‡¶æ‡¶≤
  window.openCreditModal = () => {
    document.getElementById('creditModal').classList.remove('hidden');
  };
  window.closeCreditModal = () => {
    document.getElementById('creditModal').classList.add('hidden');
  };

  function showLoginOnly() {
    loginBox.style.display = 'flex';
    appDiv.style.display = 'none';
    bgLogin.style.display = 'block';
    bgApp.style.display = 'none';
    splash.classList.remove('show');
  }

  function showAppAfterLogin(user) {
    splash.classList.add('show');
    bgLogin.style.display = 'none';
    bgApp.style.display = 'block';
    loginBox.style.display = 'none';
    
    setTimeout(() => {
      splash.classList.remove('show');
      appDiv.style.display = 'block';
    }, 3500); // 3.5 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°

    if (user.email === 'sanykhaled2@gmail.com') {
      currentUserRole = 'admin';
      document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
    } else {
      currentUserRole = 'viewer';
      document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
    }
    loadDashboard();
  }

  window.login = async () => {
    const email = document.getElementById('email').value.trim();
    const pass = document.getElementById('password').value.trim();
    if (!email || !pass) { alert('‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®'); return; }
    try {
      const userCred = await signInWithEmailAndPassword(auth, email, pass);
      showAppAfterLogin(userCred.user);
    } catch (err) {
      alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + err.message);
    }
  };

  window.logout = async () => {
    await signOut(auth);
  };

  auth.onAuthStateChanged((user) => {
    if (user) {
      showAppAfterLogin(user);
    } else {
      showLoginOnly();
    }
  });

  async function loadDashboard() {
    spinner.style.display = 'block';
    try {
      await Promise.all([
        loadIncomeCategories(),
        loadExpenseCategories(),
        loadIncomeDetails(),
        loadExpenseDetails(),
        loadWorks(),
        loadAllMembers()
      ]);
    } catch (e) {
      console.error(e);
      alert('‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ Firestore ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§');
    } finally {
      spinner.style.display = 'none';
    }
  }

  // ---------- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø (‡¶Ü‡ßü) ----------
  async function loadIncomeCategories() {
    const snap = await getDocs(collection(db, 'incomeCategories'));
    incomeCategories = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderIncomeCategories();
    populateIncomeCategorySelect();
  }

  function renderIncomeCategories() {
    const container = document.getElementById('incomeCategoryGrid');
    if (!container) return;
    let html = '';
    incomeCategories.forEach(cat => {
      html += `<div class="category-item">
        <span class="category-name">${cat.name}</span>
        <span class="card-actions">
          <button class="action-btn" onclick="editIncomeCategory('${cat.id}','${cat.name}')"><i class="fas fa-edit"></i></button>
          <button class="action-btn delete-btn" onclick="deleteIncomeCategory('${cat.id}','${cat.name}')"><i class="fas fa-trash"></i></button>
        </span>
      </div>`;
    });
    container.innerHTML = html || '<p>‡¶ï‡ßã‡¶® ‡¶ñ‡¶æ‡¶§ ‡¶®‡ßá‡¶á</p>';
  }

  window.addIncomeCategory = async () => {
    const name = document.getElementById('newIncomeCategory').value.trim();
    if (!name) return alert('‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®');
    await addDoc(collection(db, 'incomeCategories'), { name });
    document.getElementById('newIncomeCategory').value = '';
    await loadIncomeCategories();
  };

  window.editIncomeCategory = (id, oldName) => {
    const newName = prompt('‡¶ñ‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®', oldName);
    if (newName && newName !== oldName) {
      const batch = writeBatch(db);
      const catRef = doc(db, 'incomeCategories', id);
      batch.update(catRef, { name: newName });

      getDocs(query(collection(db, 'income'), where('category', '==', oldName)))
        .then(snap => {
          snap.docs.forEach(d => batch.update(d.ref, { category: newName }));
          return batch.commit();
        })
        .then(() => {
          loadIncomeCategories();
          loadIncomeDetails();
        });
    }
  };

  window.deleteIncomeCategory = async (id, name) => {
    if (!confirm(`"${name}" ‡¶ñ‡¶æ‡¶§‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶≤‡ßá ‡¶è‡¶á ‡¶ñ‡¶æ‡¶§‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶Ü‡ßü‡ßá‡¶∞ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?`)) return;
    const batch = writeBatch(db);
    const incomeSnap = await getDocs(query(collection(db, 'income'), where('category', '==', name)));
    incomeSnap.docs.forEach(d => batch.delete(d.ref));
    batch.delete(doc(db, 'incomeCategories', id));
    await batch.commit();
    await Promise.all([loadIncomeCategories(), loadIncomeDetails()]);
  };

  function populateIncomeCategorySelect() {
    const select = document.getElementById('incomeCategorySelect');
    if (select) select.innerHTML = incomeCategories.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
  }

  // ---------- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø (‡¶¨‡ßç‡¶Ø‡ßü) ----------
  async function loadExpenseCategories() {
    const snap = await getDocs(collection(db, 'expenseCategories'));
    expenseCategories = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderExpenseCategories();
    populateExpenseCategorySelect();
  }

  function renderExpenseCategories() {
    const container = document.getElementById('expenseCategoryGrid');
    if (!container) return;
    let html = '';
    expenseCategories.forEach(cat => {
      html += `<div class="category-item">
        <span class="category-name">${cat.name}</span>
        <span class="card-actions">
          <button class="action-btn" onclick="editExpenseCategory('${cat.id}','${cat.name}')"><i class="fas fa-edit"></i></button>
          <button class="action-btn delete-btn" onclick="deleteExpenseCategory('${cat.id}','${cat.name}')"><i class="fas fa-trash"></i></button>
        </span>
      </div>`;
    });
    container.innerHTML = html || '<p>‡¶ï‡ßã‡¶® ‡¶ñ‡¶æ‡¶§ ‡¶®‡ßá‡¶á</p>';
  }

  window.addExpenseCategory = async () => {
    const name = document.getElementById('newExpenseCategory').value.trim();
    if (!name) return alert('‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®');
    await addDoc(collection(db, 'expenseCategories'), { name });
    document.getElementById('newExpenseCategory').value = '';
    await loadExpenseCategories();
  };

  window.editExpenseCategory = (id, oldName) => {
    const newName = prompt('‡¶ñ‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®', oldName);
    if (newName && newName !== oldName) {
      const batch = writeBatch(db);
      const catRef = doc(db, 'expenseCategories', id);
      batch.update(catRef, { name: newName });

      getDocs(query(collection(db, 'expense'), where('category', '==', oldName)))
        .then(snap => {
          snap.docs.forEach(d => batch.update(d.ref, { category: newName }));
          return batch.commit();
        })
        .then(() => {
          loadExpenseCategories();
          loadExpenseDetails();
        });
    }
  };

  window.deleteExpenseCategory = async (id, name) => {
    if (!confirm(`"${name}" ‡¶ñ‡¶æ‡¶§‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶≤‡ßá ‡¶è‡¶á ‡¶ñ‡¶æ‡¶§‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?`)) return;
    const batch = writeBatch(db);
    const expenseSnap = await getDocs(query(collection(db, 'expense'), where('category', '==', name)));
    expenseSnap.docs.forEach(d => batch.delete(d.ref));
    batch.delete(doc(db, 'expenseCategories', id));
    await batch.commit();
    await Promise.all([loadExpenseCategories(), loadExpenseDetails()]);
  };

  function populateExpenseCategorySelect() {
    const select = document.getElementById('expenseCategorySelect');
    if (select) select.innerHTML = expenseCategories.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
  }

  // ---------- ‡¶Ü‡¶Ø‡¶º ----------
  async function loadIncomeDetails() {
    const snap = await getDocs(collection(db, 'income'));
    let total = 0;
    let rows = '';
    let detailsHtml = '';
    for (const d of snap.docs) {
      const data = d.data();
      total += data.amount || 0;
      const date = data.date ? new Date(data.date.seconds*1000).toLocaleDateString('bn') : '';
      const actionButtons = currentUserRole === 'admin' 
        ? `<button class="action-btn" onclick="editIncome('${d.id}')"><i class="fas fa-edit"></i></button>
           <button class="action-btn delete-btn" onclick="deleteIncome('${d.id}')"><i class="fas fa-trash"></i></button>`
        : '';
      const detailButton = `<button class="action-btn" onclick="openIncomeDetailModal('${d.id}', '${data.category}')"><i class="fas fa-list"></i></button>`;
      rows += `<tr>
        <td>${data.category}</td><td>${data.amount} ‡¶ü‡¶æ‡¶ï‡¶æ</td><td>${date}</td>
        <td>${actionButtons}</td>
        <td>${detailButton}</td>
      </tr>`;
      detailsHtml += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #2f4050; padding:5px 0;">
        <span>${data.category}</span> <span>${data.amount} ‡¶ü‡¶æ‡¶ï‡¶æ</span> <span>${date}</span>
      </div>`;
    }
    document.getElementById('incomeTableBody').innerHTML = rows || '<tr><td colspan="5">‡¶ï‡ßã‡¶® ‡¶Ü‡¶Ø‡¶º ‡¶®‡ßá‡¶á</td></tr>';
    document.getElementById('incomeDetails').innerHTML = detailsHtml || '<p>‡¶ï‡ßã‡¶® ‡¶Ü‡¶Ø‡¶º ‡¶®‡ßá‡¶á</p>';
    document.getElementById('totalIncome').innerText = total + ' ‡¶ü‡¶æ‡¶ï‡¶æ';
    updateChartAndBalance();
  }

  window.addIncome = async () => {
    if (currentUserRole !== 'admin') return;
    const amount = Number(document.getElementById('incomeAmount').value);
    const category = document.getElementById('incomeCategorySelect').value;
    const date = document.getElementById('incomeDate').value;
    if (!amount) return alert('‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®');
    if (!category) return alert('‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
    const id = document.getElementById('editingIncomeId').value;
    const data = { category, amount, date: date ? new Date(date) : new Date() };
    if (id) {
      await setDoc(doc(db, 'income', id), data);
      document.getElementById('editingIncomeId').value = '';
      document.getElementById('incomeSubmitBtn').innerHTML = '<i class="fas fa-plus"></i> ‡¶Ü‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó';
      document.getElementById('cancelIncomeBtn').style.display = 'none';
    } else {
      await addDoc(collection(db, 'income'), data);
    }
    document.getElementById('incomeAmount').value = '';
    document.getElementById('incomeDate').value = '';
    loadIncomeDetails();
  };

  window.editIncome = (id) => {
    if (currentUserRole !== 'admin') return;
    getDoc(doc(db, 'income', id)).then(docSnap => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById('incomeCategorySelect').value = data.category;
        document.getElementById('incomeAmount').value = data.amount;
        if (data.date) {
          const d = new Date(data.date.seconds*1000).toISOString().split('T')[0];
          document.getElementById('incomeDate').value = d;
        }
        document.getElementById('editingIncomeId').value = id;
        document.getElementById('incomeSubmitBtn').innerHTML = '<i class="fas fa-edit"></i> ‡¶Ü‡¶Ø‡¶º ‡¶Ü‡¶™‡¶°‡ßá‡¶ü';
        document.getElementById('cancelIncomeBtn').style.display = 'inline-block';
      }
    });
  };

  window.deleteIncome = async (id) => {
    if (currentUserRole !== 'admin') return;
    if (confirm('‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) {
      const detailsSnap = await getDocs(query(collection(db, 'incomeDetails'), where('incomeId', '==', id)));
      const batch = writeBatch(db);
      detailsSnap.docs.forEach(d => batch.delete(d.ref));
      batch.delete(doc(db, 'income', id));
      await batch.commit();
      loadIncomeDetails();
    }
  };

  window.cancelIncomeEdit = () => {
    document.getElementById('editingIncomeId').value = '';
    document.getElementById('incomeAmount').value = '';
    document.getElementById('incomeDate').value = '';
    document.getElementById('incomeSubmitBtn').innerHTML = '<i class="fas fa-plus"></i> ‡¶Ü‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó';
    document.getElementById('cancelIncomeBtn').style.display = 'none';
  };

  // ---------- ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ----------
  async function loadExpenseDetails() {
    const snap = await getDocs(collection(db, 'expense'));
    let total = 0;
    let rows = '';
    let detailsHtml = '';
    for (const d of snap.docs) {
      const data = d.data();
      total += data.amount || 0;
      const actionButtons = currentUserRole === 'admin'
        ? `<button class="action-btn" onclick="editExpense('${d.id}')"><i class="fas fa-edit"></i></button>
           <button class="action-btn delete-btn" onclick="deleteExpense('${d.id}')"><i class="fas fa-trash"></i></button>`
        : '';
      const detailButton = `<button class="action-btn" onclick="openExpenseDetailModal('${d.id}', '${data.category}')"><i class="fas fa-list"></i></button>`;
      rows += `<tr>
        <td>${data.category}</td><td>${data.amount} ‡¶ü‡¶æ‡¶ï‡¶æ</td>
        <td>${actionButtons}</td>
        <td>${detailButton}</td>
      </tr>`;
      detailsHtml += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #2f4050; padding:5px 0;">
        <span>${data.category}</span> <span>${data.amount} ‡¶ü‡¶æ‡¶ï‡¶æ</span>
      </div>`;
    }
    document.getElementById('expenseTableBody').innerHTML = rows || '<tr><td colspan="4">‡¶ï‡ßã‡¶® ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶®‡ßá‡¶á</td></tr>';
    document.getElementById('expenseDetails').innerHTML = detailsHtml || '<p>‡¶ï‡ßã‡¶® ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶®‡ßá‡¶á</p>';
    document.getElementById('totalExpense').innerText = total + ' ‡¶ü‡¶æ‡¶ï‡¶æ';
    updateChartAndBalance();
  }

  window.addExpense = async () => {
    if (currentUserRole !== 'admin') return;
    const amount = Number(document.getElementById('expenseAmount').value);
    const category = document.getElementById('expenseCategorySelect').value;
    if (!amount) return alert('‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®');
    if (!category) return alert('‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
    const id = document.getElementById('editingExpenseId').value;
    const data = { category, amount, date: new Date() };
    if (id) {
      await setDoc(doc(db, 'expense', id), data);
      document.getElementById('editingExpenseId').value = '';
      document.getElementById('expenseSubmitBtn').innerHTML = '<i class="fas fa-plus"></i> ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó';
      document.getElementById('cancelExpenseBtn').style.display = 'none';
    } else {
      await addDoc(collection(db, 'expense'), data);
    }
    document.getElementById('expenseAmount').value = '';
    loadExpenseDetails();
  };

  window.editExpense = (id) => {
    if (currentUserRole !== 'admin') return;
    getDoc(doc(db, 'expense', id)).then(docSnap => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById('expenseCategorySelect').value = data.category;
        document.getElementById('expenseAmount').value = data.amount;
        document.getElementById('editingExpenseId').value = id;
        document.getElementById('expenseSubmitBtn').innerHTML = '<i class="fas fa-edit"></i> ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶Ü‡¶™‡¶°‡ßá‡¶ü';
        document.getElementById('cancelExpenseBtn').style.display = 'inline-block';
      }
    });
  };

  window.deleteExpense = async (id) => {
    if (currentUserRole !== 'admin') return;
    if (confirm('‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) {
      const detailsSnap = await getDocs(query(collection(db, 'expenseDetails'), where('expenseId', '==', id)));
      const batch = writeBatch(db);
      detailsSnap.docs.forEach(d => batch.delete(d.ref));
      batch.delete(doc(db, 'expense', id));
      await batch.commit();
      loadExpenseDetails();
    }
  };

  window.cancelExpenseEdit = () => {
    document.getElementById('editingExpenseId').value = '';
    document.getElementById('expenseAmount').value = '';
    document.getElementById('expenseSubmitBtn').innerHTML = '<i class="fas fa-plus"></i> ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó';
    document.getElementById('cancelExpenseBtn').style.display = 'none';
  };

  // ---------- ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü ----------
  function updateChartAndBalance() {
    const inc = Number(document.getElementById('totalIncome').innerText.split(' ')[0]) || 0;
    const exp = Number(document.getElementById('totalExpense').innerText.split(' ')[0]) || 0;
    document.getElementById('balance').innerText = (inc - exp) + ' ‡¶ü‡¶æ‡¶ï‡¶æ';

    const ctx = document.getElementById('financeChart')?.getContext('2d');
    if (!ctx) return;

    if (window.financeChart && typeof window.financeChart.destroy === 'function') {
      window.financeChart.destroy();
    }
    window.financeChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['‡¶Ü‡¶Ø‡¶º', '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º', '‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏'],
        datasets: [{
          data: [inc, exp, inc - exp],
          backgroundColor: ['#2ecc71', '#e74c3c', '#3498db']
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: { ticks: { color: '#ccc' }, grid: { color: '#2f4050' } },
          x: { ticks: { color: '#ccc' } }
        }
      }
    });
  }

  // ---------- ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™ ‡¶ì ‡¶ï‡¶æ‡¶ú ----------
  async function loadWorks() {
    const snap = await getDocs(collection(db, 'works'));
    const container = document.getElementById('projectListContainer');
    if (!container) return;

    if (snap.empty) {
      container.innerHTML = '<p class="no-data">‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™ ‡¶®‡ßá‡¶á</p>';
      return;
    }

    let html = '';
    snap.docs.forEach(d => {
      const w = d.data();
      const workId = d.id;
      const actionButtons = currentUserRole === 'admin'
        ? `<div class="detail-actions">
            <button class="action-btn" onclick="editWork('${workId}')"><i class="fas fa-edit"></i> ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
            <button class="action-btn delete-btn" onclick="deleteWork('${workId}')"><i class="fas fa-trash"></i> ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
          </div>`
        : '';
      html += `
        <div class="project-item">
          <button class="project-name-btn" onclick="toggleWorkDetails('${workId}')">
            <i class="fas fa-folder-open"></i> ${w.name}
          </button>
          <div id="details-${workId}" class="project-details">
            <div class="detail-row">
              <span class="detail-label">‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</span>
              <span class="detail-value">${w.budget} ‡¶ü‡¶æ‡¶ï‡¶æ</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</span>
              <span class="detail-value">${w.status === 'ongoing' ? '‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®' : w.status === 'upcoming' ? '‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ' : '‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®'}</span>
            </div>
            ${actionButtons}
          </div>
        </div>
      `;
    });
    container.innerHTML = html;
  }

  window.toggleWorkDetails = (workId) => {
    const detailsDiv = document.getElementById(`details-${workId}`);
    if (detailsDiv) {
      detailsDiv.classList.toggle('show');
    }
  };

  window.addWork = async () => {
    if (currentUserRole !== 'admin') return;
    const name = document.getElementById('workName').value.trim();
    const budget = Number(document.getElementById('workBudget').value);
    const status = document.getElementById('workStatus').value;
    const editingId = document.getElementById('editingWorkId').value;
    if (!name || !budget) return alert('‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶¶‡¶ø‡¶®');
    const data = { name, budget, status };
    if (editingId) {
      await setDoc(doc(db, 'works', editingId), data, { merge: true });
      document.getElementById('editingWorkId').value = '';
      document.getElementById('workSubmitBtn').innerHTML = '<i class="fas fa-plus"></i> ‡¶ï‡¶æ‡¶ú ‡¶Ø‡ßã‡¶ó';
      document.getElementById('cancelWorkBtn').style.display = 'none';
    } else {
      await addDoc(collection(db, 'works'), data);
    }
    document.getElementById('workName').value = '';
    document.getElementById('workBudget').value = '';
    await loadWorks();
  };

  window.editWork = (id) => {
    if (currentUserRole !== 'admin') return;
    getDoc(doc(db, 'works', id)).then(docSnap => {
      if (docSnap.exists()) {
        const w = docSnap.data();
        document.getElementById('workName').value = w.name;
        document.getElementById('workBudget').value = w.budget;
        document.getElementById('workStatus').value = w.status;
        document.getElementById('editingWorkId').value = id;
        document.getElementById('workSubmitBtn').innerHTML = '<i class="fas fa-edit"></i> ‡¶ï‡¶æ‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü';
        document.getElementById('cancelWorkBtn').style.display = 'inline-block';
      }
    });
  };

  window.deleteWork = async (id) => {
    if (currentUserRole !== 'admin') return;
    if (confirm('‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
      await deleteDoc(doc(db, 'works', id));
      await loadWorks();
    }
  };

  window.cancelWorkEdit = () => {
    document.getElementById('editingWorkId').value = '';
    document.getElementById('workName').value = '';
    document.getElementById('workBudget').value = '';
    document.getElementById('workSubmitBtn').innerHTML = '<i class="fas fa-plus"></i> ‡¶ï‡¶æ‡¶ú ‡¶Ø‡ßã‡¶ó';
    document.getElementById('cancelWorkBtn').style.display = 'none';
  };

  // ---------- ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ----------
  async function loadAllMembers() {
    const snap = await getDocs(collection(db, 'members'));
    allMembers = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    memberContainer.innerHTML = '';
  }

  async function renderMemberCards(membersArray) {
    if (membersArray.length === 0) {
      memberContainer.innerHTML = '';
      return;
    }
    let html = '';
    for (const m of membersArray) {
      const paySnap = await getDocs(query(collection(db, 'payments'), where('name', '==', m.name), where('year', '==', m.year)));
      const paidCount = paySnap.size;
      const paidAmount = paidCount * m.salary;
      const yearly = m.salary * 12;
      const due = yearly - paidAmount;
      const actionButtons = currentUserRole === 'admin'
        ? `<span class="card-actions">
            <button class="action-btn" onclick="editMember('${m.id}')"><i class="fas fa-edit"></i></button>
            <button class="action-btn delete-btn" onclick="deleteMember('${m.id}')"><i class="fas fa-trash"></i></button>
          </span>`
        : '';
      html += `<div class="member-card" data-id="${m.id}">
        <h4>
          <i class="fas fa-user"></i> ${m.name}
          ${actionButtons}
        </h4>
        <p><i class="fas fa-calendar"></i> ‡¶∏‡¶æ‡¶≤: ${m.year}</p>
        <p><i class="fas fa-coins"></i> ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï: ${m.salary} ‡¶ü‡¶æ‡¶ï‡¶æ</p>
        <p><i class="fas fa-check-circle" style="color:#6f9e6f;"></i> ‡¶ú‡¶Æ‡¶æ: ${paidAmount} ‡¶ü‡¶æ‡¶ï‡¶æ (${paidCount} ‡¶Æ‡¶æ‡¶∏)</p>
        <p class="due-highlight"><i class="fas fa-exclamation-triangle"></i> ‡¶¨‡¶æ‡¶ï‡¶ø: ${due} ‡¶ü‡¶æ‡¶ï‡¶æ (${12-paidCount} ‡¶Æ‡¶æ‡¶∏)</p>
      </div>`;
    }
    memberContainer.innerHTML = html;
  }

  window.handleSearchInput = () => {
    const input = searchInput.value.trim().toLowerCase();
    if (input === '') {
      autocompleteDropdown.style.display = 'none';
      memberContainer.innerHTML = '';
      return;
    }
    const matches = allMembers.map(m => m.name).filter(name => name.toLowerCase().includes(input)).slice(0,10);
    if (matches.length > 0) {
      let dropdownHtml = '';
      matches.forEach(name => {
        dropdownHtml += `<div class="autocomplete-item" onmousedown="selectAutocomplete('${name}')">${name}</div>`;
      });
      autocompleteDropdown.innerHTML = dropdownHtml;
      autocompleteDropdown.style.display = 'block';
    } else {
      autocompleteDropdown.style.display = 'none';
    }
  };

  window.selectAutocomplete = (name) => {
    searchInput.value = name;
    autocompleteDropdown.style.display = 'none';
    filterMembers();
  };

  window.hideAutocomplete = () => {
    setTimeout(() => autocompleteDropdown.style.display = 'none', 200);
  };

  window.filterMembers = () => {
    const text = searchInput.value.trim().toLowerCase();
    if (text === '') {
      memberContainer.innerHTML = '';
    } else {
      const filtered = allMembers.filter(m => m.name.toLowerCase().includes(text));
      renderMemberCards(filtered);
    }
    autocompleteDropdown.style.display = 'none';
  };

  window.addOrUpdateMember = async () => {
    if (currentUserRole !== 'admin') return;
    const name = document.getElementById('memberName').value.trim();
    const year = Number(document.getElementById('memberYear').value);
    const salary = Number(document.getElementById('memberSalary').value);
    const month = document.getElementById('payMonth').value.trim();
    const editingId = document.getElementById('editingMemberId').value;

    if (!name || !year || !salary) return alert('‡¶®‡¶æ‡¶Æ, ‡¶∏‡¶æ‡¶≤ ‡¶ì ‡¶¨‡ßá‡¶§‡¶® ‡¶¶‡¶ø‡¶®');

    if (editingId) {
      await setDoc(doc(db, 'members', editingId), { name, year, salary }, { merge: true });
      document.getElementById('editingMemberId').value = '';
      document.getElementById('memberSubmitBtn').innerHTML = '<i class="fas fa-save"></i> ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ / ‡¶ú‡¶Æ‡¶æ';
      document.getElementById('cancelMemberBtn').style.display = 'none';
    } else {
      const q = query(collection(db, 'members'), where('name', '==', name), where('year', '==', year));
      const snap = await getDocs(q);
      if (snap.empty) {
        await addDoc(collection(db, 'members'), { name, year, salary });
      } else {
        await setDoc(snap.docs[0].ref, { name, year, salary }, { merge: true });
      }
    }

    if (month && !editingId) {
      await addDoc(collection(db, 'payments'), { name, year, month, salary, date: new Date() });
    }

    document.getElementById('memberName').value = '';
    document.getElementById('memberYear').value = '';
    document.getElementById('memberSalary').value = '';
    document.getElementById('payMonth').value = '';
    loadAllMembers();
  };

  window.editMember = (id) => {
    if (currentUserRole !== 'admin') return;
    const member = allMembers.find(m => m.id === id);
    if (member) {
      document.getElementById('memberName').value = member.name;
      document.getElementById('memberYear').value = member.year;
      document.getElementById('memberSalary').value = member.salary;
      document.getElementById('editingMemberId').value = id;
      document.getElementById('memberSubmitBtn').innerHTML = '<i class="fas fa-edit"></i> ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü';
      document.getElementById('cancelMemberBtn').style.display = 'inline-block';
    }
  };

  window.deleteMember = async (id) => {
    if (currentUserRole !== 'admin') return;
    if (confirm('‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? (‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡ßá‡¶ó‡ßÅ‡¶≤‡ßã‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá)')) {
      const member = allMembers.find(m => m.id === id);
      if (member) {
        const paymentsSnap = await getDocs(query(collection(db, 'payments'), where('name', '==', member.name), where('year', '==', member.year)));
        paymentsSnap.forEach(async (p) => { await deleteDoc(p.ref); });
      }
      await deleteDoc(doc(db, 'members', id));
      loadAllMembers();
    }
  };

  window.cancelMemberEdit = () => {
    document.getElementById('editingMemberId').value = '';
    document.getElementById('memberName').value = '';
    document.getElementById('memberYear').value = '';
    document.getElementById('memberSalary').value = '';
    document.getElementById('payMonth').value = '';
    document.getElementById('memberSubmitBtn').innerHTML = '<i class="fas fa-save"></i> ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ / ‡¶ú‡¶Æ‡¶æ';
    document.getElementById('cancelMemberBtn').style.display = 'none';
  };

  window.toggleIncomeDetails = () => {
    const el = document.getElementById('incomeDetails');
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
  };
  window.toggleExpenseDetails = () => {
    const el = document.getElementById('expenseDetails');
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
  };

  let slideIndex = 0;
  function showSlides() {
    const slides = document.getElementsByClassName('slide-img');
    for (let i = 0; i < slides.length; i++) slides[i].classList.remove('active-slide');
    slideIndex++; if (slideIndex > slides.length) slideIndex = 1;
    slides[slideIndex-1]?.classList.add('active-slide');
    setTimeout(showSlides, 4000);
  }
  setTimeout(showSlides, 500);
</script>
</body>
</html>
